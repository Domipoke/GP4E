<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GP4E</title>
</head>
<body>
    <style>
        body {
            padding: 0;
            margin:0;
        }
        #dbar {
            background-color: #006469;
            padding: 5px;
            margin:0;
            width: 100%
        }
        #bar {
            float:right
        }
        #btn {
            background: none;
            border: none;
            outline: none;
            padding: 0;
            margin: 5px;
            font-size: 32px;
            height: 30px;
            display: block;
        }
        .g-signin2 {
            float: right;
        }    
    </style>
    <table id="dbar">
        <tr >
            <td><Button id="btn" onclick="toggleBar()">^</Button></td>
            <td id="bar">
                <Button id="login" onClick="login()">Discord</Button>
            </td>
        </tr>    
    </table>
    <div id="info"></div>
    

    
    <script src="jquery/jquery-3.6.0.min.js"></script>
    <script src="anime-master\anime-master\lib\anime.min.js"></script>
    <script src="user-helper\user.js"></script>
    <script src="utility/switch.js"></script>
    <script>
        window.onload = function () {
            //code=sy7Zg9VzCVRbd3IPTo9q8guBQgGDVp
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = fragment.get('access_token')
            const tokenType = fragment.get('token_type')

            if (!accessToken) {
                return document.getElementById('login').style.display = 'block';
            }

            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `${tokenType} ${accessToken}`,
                },
            })
                .then(result => result.json())
                .then(response => {
                    const { username, discriminator } = response;
                    document.getElementById('info').innerText += ` ${username}#${discriminator}`;
                })
                .catch(console.error);
        }
        function login() {
            //force_verify=false
            //&state=9e33cbe206d87451ab6e6e367eb86890
            var url = "https://discord.com/api/oauth2/authorize?client_id=915328384945487963&redirect_uri=https%3A%2F%2Fdomipoke.github.io%2FGP4E%2Fhome.html&response_type=code&scope=identify&prompt=none&approval_prompt=auto"
            var _name = "window"
            var w = window.open(url,_name,"popup")
            
        }
        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            //mem(profile)
            //ChangeButton
            // var gProfile = {
            //     in:document.querySelector(".g-signin2"),
            //     stay:document.querySelector(".profile"),
            //     out:document.querySelector(".signout")
            // }
            // var div = document.createElement("div")
            // var img = document.createElement("img")
            // img.setAttribute("src",profile.getImageUrl())
            // img.style.width=50
            // img.style.height=50
            // div.appendChild(img)
            // gProfile.innerHTML
        }
        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
            });
            window.localStorage.clear()
        }
        function toggleBar() {
            if (document.querySelector("#bar").style.display=="block") {
                anime({
                    targets: "#btn",
                    rotateZ: 180,
                    duration: 500
                }).finished.then(function () {
                    anime({
                        targets: "#dbar",
                        translateY: "-18",
                        duration: 500
                    }).finished.then(document.querySelector("#bar").style.display = "none")
                })
            } else {
                anime({
                    targets: "#btn",
                    rotateZ: 0,
                    duration: 500
                }).finished.then(function () {
                    anime({
                        targets: "#dbar",
                        translateY: "0",
                        duration: 500
                    }).finished.then(document.querySelector("#bar").style.display = "block")
                })
            }
            
            
            
        }
    </script>
</body>
</html>